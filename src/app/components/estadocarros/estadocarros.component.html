<!-- üöó SECCI√ìN DE VEH√çCULOS -->
<div class="card">
  <div class="card-head">Registrar Veh√≠culo</div>
  <div class="card-body">
    <form (ngSubmit)="guardarVehiculo()">
      <div class="form-grid">
        <input placeholder="Placa" [(ngModel)]="vehiculo.placa" name="placa" required />
        <input placeholder="Tipo" [(ngModel)]="vehiculo.tipo" name="tipo" />
        <input placeholder="Marca" [(ngModel)]="vehiculo.marca" name="marca" />
        <input placeholder="Modelo" [(ngModel)]="vehiculo.modelo" name="modelo" />
        <input placeholder="A√±o" type="number" [(ngModel)]="vehiculo.anio" name="anio" />
        <input placeholder="Estado actual" [(ngModel)]="vehiculo.estadoActual" name="estadoActual" />
      </div>

      <div class="button-group">
        <button type="submit" class="btn-guardar">Guardar</button>
        <button type="button" class="btn-cancelar" (click)="limpiarVehiculo()">Cancelar</button>
      </div>
    </form>

    <input
      type="text"
      placeholder="Buscar veh√≠culo..."
      [(ngModel)]="searchVehiculo"
      (input)="buscarVehiculo()"
    />

    <table>
      <thead>
        <tr>
          <th>Placa</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let v of vehiculos | slice:(paginaVehiculo-1)*itemsVehiculo:(paginaVehiculo*itemsVehiculo)">
          <td>{{ v.placa }}</td>
          <td>{{ v.marca }}</td>
          <td>{{ v.modelo }}</td>
          <td>{{ v.estadoActual }}</td>
          <td>
            <button (click)="editarVehiculo(v)" class="btn-editar">‚úèÔ∏è</button>
            <button (click)="eliminarVehiculo(v.id)" class="btn-eliminar">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="paginacion">
      <button [disabled]="paginaVehiculo === 1" (click)="cambiarPaginaVehiculo(-1)">‚¨ÖÔ∏è</button>
      <span>P√°gina {{ paginaVehiculo }} de {{ totalVehiculos }}</span>
      <button [disabled]="paginaVehiculo === totalVehiculos" (click)="cambiarPaginaVehiculo(1)">‚û°Ô∏è</button>
    </div>
  </div>
</div>

<!-- üßæ SECCI√ìN DE HISTORIAL -->
<div class="card">
  <div class="card-head">Registrar Historial de Veh√≠culo</div>
  <div class="card-body">
    <form (ngSubmit)="guardarHistorial()">
      <div class="form-grid">
        <!-- Veh√≠culo -->
        <div class="form-group">
          <label for="vehiculoHistorial">Veh√≠culo *</label>
          <select id="vehiculoHistorial" [(ngModel)]="historial.vehiculo.id" name="vehiculo" required>
            <option value="">Seleccione el veh√≠culo</option>
            <option *ngFor="let v of vehiculos" [value]="v.id">
              {{ v.placa }} - {{ v.marca }} ({{ v.estadoActual }})
            </option>
          </select>
        </div>

        <!-- Estado -->
        <div class="form-group">
          <label for="estadoHistorial">Estado actual *</label>
          <input id="estadoHistorial" placeholder="Ej. En ruta, Mantenimiento..." [(ngModel)]="historial.estado" name="estado" required />
        </div>

        <!-- Fecha -->
        <div class="form-group">
          <label for="fechaHistorial">Fecha *</label>
          <input id="fechaHistorial" type="date" [(ngModel)]="historial.fecha" name="fecha" required />
        </div>

        <!-- Notas -->
        <div class="form-group">
          <label for="notasHistorial">Notas</label>
          <textarea id="notasHistorial" [(ngModel)]="historial.notas" name="notas" placeholder="Escriba observaciones adicionales..."></textarea>
        </div>
      </div>

      <div class="button-group">
        <button type="submit" class="btn-guardar">Guardar</button>
        <button type="button" class="btn-cancelar" (click)="limpiarHistorial()">Cancelar</button>
      </div>
    </form>

    <input
      type="text"
      placeholder="üîç Buscar historial por veh√≠culo o estado..."
      [(ngModel)]="searchHistorial"
      (input)="buscarHistorial()"
    />

    <table>
      <thead>
        <tr>
          <th>Veh√≠culo</th>
          <th>Estado</th>
          <th>Fecha</th>
          <th>Notas</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let h of historiales | slice:(paginaHistorial-1)*itemsHistorial:(paginaHistorial*itemsHistorial)">
          <td>{{ h.vehiculo?.placa }}</td>
          <td>{{ h.estado }}</td>
          <td>{{ h.fecha | date: 'dd/MM/yyyy' }}</td>
          <td>{{ h.notas }}</td>
          <td>
            <button (click)="editarHistorial(h)" class="btn-editar">‚úèÔ∏è</button>
            <button (click)="eliminarHistorial(h.id)" class="btn-eliminar">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="paginacion">
      <button [disabled]="paginaHistorial === 1" (click)="cambiarPaginaHistorial(-1)">‚¨ÖÔ∏è</button>
      <span>P√°gina {{ paginaHistorial }} de {{ totalHistorial }}</span>
      <button [disabled]="paginaHistorial === totalHistorial" (click)="cambiarPaginaHistorial(1)">‚û°Ô∏è</button>
    </div>
  </div>
</div>


<!-- üöö SECCI√ìN DE ASIGNACIONES -->
<div class="card">
  <div class="card-head">Registrar Asignaci√≥n</div>
  <div class="card-body">
    <form (ngSubmit)="guardarAsignacion()">
      <div class="form-grid">

        <!-- Solicitud -->
        <div class="form-group">
          <label for="solicitud">Solicitud *</label>
          <select
            id="solicitud"
            [(ngModel)]="solicitudSeleccionadaId"
            name="solicitud"
            required
          >
            <option value="">Seleccione una solicitud</option>
            <option *ngFor="let s of solicitudes" [value]="s.id">
              {{ s.cliente?.nombre }} - {{ s.destino }}
            </option>
          </select>
        </div>

        <!-- Veh√≠culo -->
        <div class="form-group">
          <label for="vehiculo">Veh√≠culo *</label>
          <select
            id="vehiculo"
            [(ngModel)]="vehiculoAsignadoId"
            name="vehiculo"
            required
          >
            <option value="">Seleccione un veh√≠culo</option>
            <option *ngFor="let v of vehiculos" [value]="v.id">
              {{ v.placa }} - {{ v.marca }} ({{ v.estadoActual }})
            </option>
          </select>
        </div>

        <!-- Conductor -->
        <div class="form-group">
          <label for="conductor">Conductor *</label>
          <select
            id="conductor"
            [(ngModel)]="conductorSeleccionadoId"
            name="conductor"
            required
          >
            <option value="">Seleccione un conductor</option>
            <option *ngFor="let c of conductores" [value]="c.id">
              {{ c.username }}
            </option>
          </select>
        </div>

        <!-- Estado -->
        <div class="form-group">
          <label for="estado">Estado *</label>
          <input
            id="estado"
            placeholder="Ej. Activa, Pendiente..."
            [(ngModel)]="asignacion.estado"
            name="estado"
            required
          />
        </div>

        <!-- Fechas -->
        <div class="form-group">
          <label for="inicio">Fecha inicio *</label>
          <input
            id="inicio"
            type="date"
            [(ngModel)]="asignacion.inicio"
            name="inicio"
            required
          />
        </div>

        <div class="form-group">
          <label for="fin">Fecha fin *</label>
          <input
            id="fin"
            type="date"
            [(ngModel)]="asignacion.fin"
            name="fin"
            required
          />
        </div>
      </div>

      <div class="button-group">
        <button type="submit" class="btn-guardar">Guardar</button>
        <button type="button" class="btn-cancelar" (click)="limpiarAsignacion()">Cancelar</button>
      </div>
    </form>

    <input
      type="text"
      placeholder="üîç Buscar por veh√≠culo o conductor..."
      [(ngModel)]="searchAsignacion"
      (input)="buscarAsignacion()"
    />

    <table>
      <thead>
        <tr>
          <th>Veh√≠culo</th>
          <th>Conductor</th>
          <th>Estado</th>
          <th>Inicio</th>
          <th>Fin</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let a of asignaciones | slice:(paginaAsignacion-1)*itemsAsignacion:(paginaAsignacion*itemsAsignacion)"
        >
          <td>{{ a.vehiculo?.placa }}</td>
          <td>{{ a.conductor?.username }}</td>
          <td>{{ a.estado }}</td>
          <td>{{ a.inicio | date: 'dd/MM/yyyy' }}</td>
          <td>{{ a.fin | date: 'dd/MM/yyyy' }}</td>
          <td>
            <button (click)="editarAsignacion(a)" class="btn-editar">‚úèÔ∏è</button>
            <button (click)="eliminarAsignacion(a.id)" class="btn-eliminar">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="paginacion">
      <button
        [disabled]="paginaAsignacion === 1"
        (click)="cambiarPaginaAsignacion(-1)"
      >
        ‚¨ÖÔ∏è
      </button>
      <span>P√°gina {{ paginaAsignacion }} de {{ totalAsignaciones }}</span>
      <button
        [disabled]="paginaAsignacion === totalAsignaciones"
        (click)="cambiarPaginaAsignacion(1)"
      >
        ‚û°Ô∏è
      </button>
    </div>
  </div>
</div>
